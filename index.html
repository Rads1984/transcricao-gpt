<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transcrição Inteligente com GPT</title>
  <script src="https://cdn.jsdelivr.net/npm/@whispercpp/whisper-wasm@latest/dist/whisper-wasm.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input[type="file"], select, textarea, button {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 20px;
    }
    .preview-models {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .model-view {
      flex: 1;
      min-width: 280px;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      background: #fafafa;
    }
    .correction-options, .resumo-section {
      margin-top: 30px;
      background: #f0f8ff;
      padding: 20px;
      border-radius: 10px;
    }
    .correction-options h3, .resumo-section h3 {
      margin-top: 0;
    }
    .tag-selector {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .tag-selector label {
      background: #dfefff;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    .tag-selector input {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎤 Transcrição Inteligente com GPT</h1>

    <label for="audioUpload">📤 Envie seu áudio:</label>
    <input type="file" id="audioUpload" accept="audio/*">
    <button onclick="transcreverAudio()">🎙️ Iniciar Transcrição</button>

    <label for="fontSelect">🅰️ Escolha a fonte:</label>
    <select id="fontSelect" onchange="aplicarEstilo()">
      <option value="Arial">Arial</option>
      <option value="Calibri">Calibri</option>
      <option value="Times New Roman">Times New Roman</option>
    </select>

    <label for="fontSize">🔠 Tamanho da fonte:</label>
    <select id="fontSize" onchange="aplicarEstilo()">
      <option value="14px">Pequeno</option>
      <option value="16px" selected>Médio</option>
      <option value="18px">Grande</option>
    </select>

    <label for="outputText">📝 Transcrição Corrigida:</label>
    <textarea id="outputText" rows="10"></textarea>

    <button onclick="copyText()">📋 Copiar</button>
    <button onclick="exportDoc()">📄 Exportar como Word</button>
    <button onclick="preparePrompt()">🤖 Enviar para ChatGPT</button>

    <div class="preview-models">
      <div class="model-view" id="model1">
        <h3>Modelo 1 – Transcrição na Íntegra (Texto Puro)</h3>
        <p>Exibe todo o conteúdo sem edição. Ideal para quem deseja revisar cada fala ou usar o material cru.</p>
      </div>
      <div class="model-view" id="model2">
        <h3>Modelo 2 – Texto Organizado com Imagens</h3>
        <p>Adiciona estrutura com títulos, subtítulos e ilustrações compatíveis com o tema. Pode incluir emojis e ícones explicativos.</p>
      </div>
      <div class="model-view" id="model3">
        <h3>Modelo 3 – Resumo Personalizado</h3>
        <p id="resumoOutput">Você escolhe os tópicos importantes (ex: definição, conduta, diagnóstico) e o site monta um resumo com base nisso.</p>
      </div>
    </div>

    <div class="resumo-section">
      <h3>📋 Selecione os tópicos que deseja incluir no resumo:</h3>
      <div class="tag-selector">
        <label><input type="checkbox" value="Definição">Definição</label>
        <label><input type="checkbox" value="Etiologia">Etiologia</label>
        <label><input type="checkbox" value="Diagnóstico">Diagnóstico</label>
        <label><input type="checkbox" value="Tratamento">Tratamento</label>
        <label><input type="checkbox" value="Conduta">Conduta</label>
        <label><input type="checkbox" value="Dica de Prova">Dica de Prova</label>
      </div>
      <button onclick="gerarResumo()">📌 Gerar Resumo</button>
    </div>

    <div class="correction-options">
      <h3>✍️ Correção Gramatical (3 opções):</h3>
      <ol>
        <li><strong>Automática via API GPT-4:</strong> Se você inserir sua chave da OpenAI, o texto será corrigido automaticamente.</li>
        <li><strong>Manual com ChatGPT:</strong> Use o botão “Enviar para ChatGPT” para colar o texto com um prompt inteligente.</li>
        <li><strong>Correção gratuita no navegador:</strong> Com LanguageTool ou extensões integradas ao navegador (ortografia + pontuação).</li>
      </ol>
    </div>
  </div>

  <script>
    function copyText() {
      const text = document.getElementById("outputText");
      text.select();
      document.execCommand("copy");
      alert("Texto copiado!");
    }

    function exportDoc() {
      const text = document.getElementById("outputText").value;
      const blob = new Blob([text], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "transcricao.doc";
      a.click();
    }

    function preparePrompt() {
      const text = document.getElementById("outputText").value;
      const prompt = `Organize e corrija o texto a seguir com pontuação, parágrafos, gramática e coerência:\n\n${text}`;
      navigator.clipboard.writeText(prompt);
      alert("Prompt copiado! Cole no ChatGPT Plus para organizar.");
    }

    function aplicarEstilo() {
      const font = document.getElementById("fontSelect").value;
      const size = document.getElementById("fontSize").value;
      const textarea = document.getElementById("outputText");
      textarea.style.fontFamily = font;
      textarea.style.fontSize = size;
    }

    async function transcreverAudio() {
      alert("Transcrição offline via Whisper ainda será configurada com modelo wasm.");
    }

    function gerarResumo() {
      const texto = document.getElementById("outputText").value;
      const checkboxes = document.querySelectorAll('.tag-selector input[type="checkbox"]:checked');
      const topicosSelecionados = Array.from(checkboxes).map(cb => cb.value);

      if (!texto.trim()) {
        alert("Você precisa ter um texto transcrito primeiro.");
        return;
      }

      if (topicosSelecionados.length === 0) {
        alert("Selecione ao menos um tópico para gerar o resumo.");
        return;
      }

      const linhas = texto.split("\n");
      const resumo = linhas.filter(linha => {
        return topicosSelecionados.some(topico => linha.toLowerCase().includes(topico.toLowerCase()));
      });

      const saida = resumo.length > 0 ? resumo.join("\n") : "Nenhum trecho relacionado aos tópicos selecionados foi encontrado.";
      document.getElementById("resumoOutput").textContent = saida;
    }
  </script>
</body>
</html>
